{
  "openapi": "3.0.0",
  "info": {
    "title": "API de Gestión de Tareas y Usuarios",
    "version": "1.0.0",
    "description": "Una API para gestionar usuarios y tareas, con funcionalidad de generación de tareas asistida por IA."
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Servidor de desarrollo"
    },
    {
      "url": "http://0.0.0.0:8080",
      "description": "Servidor de producción"
    }
  ],
  "tags": [
    {
      "name": "Usuarios",
      "description": "Operaciones relacionadas con la gestión de usuarios y autenticación."
    },
    {
      "name": "Tareas",
      "description": "Operaciones relacionadas con la gestión de tareas."
    },
    {
      "name": "Inteligencia Artificial",
      "description": "Operaciones para generar tareas usando IA."
    }
  ],
  "paths": {
    "/usuarios": {
      "post": {
        "tags": ["Usuarios"],
        "summary": "Crear un nuevo usuario",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UsuarioCreacion"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Usuario creado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "pk": {
                      "type": "integer",
                      "description": "ID del usuario creado"
                    },
                    "email": {
                      "type": "string",
                      "format": "email",
                      "description": "Email del usuario creado"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Email y contraseña son requeridos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al hashear la contraseña o al insertar usuario en la BD",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/login": {
      "post": {
        "tags": ["Usuarios"],
        "summary": "Iniciar sesión de usuario",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Inicio de sesión exitoso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          },
          "400": {
            "description": "Email y contraseña requeridos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Usuario no encontrado o contraseña incorrecta",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al verificar contraseña o al guardar la sesión",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/logout": {
      "post": {
        "tags": ["Usuarios"],
        "summary": "Cerrar sesión de usuario",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Sesión cerrada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "mensaje": {
                      "type": "string",
                      "example": "Sesión cerrada"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "No autorizado. Inicia sesión primero.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/tareas/de/{usuario}": {
      "get": {
        "tags": ["Tareas"],
        "summary": "Obtener todas las tareas de un usuario",
        "parameters": [
          {
            "name": "usuario",
            "in": "path",
            "required": true,
            "description": "ID del usuario",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de tareas del usuario",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Tarea"
                  }
                }
              }
            }
          },
          "401": {
            "description": "No autorizado. Inicia sesión primero.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "No autorizado. Solo puedes acceder a tus propias tareas.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al obtener tareas por usuario",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/tareas/por/{id}": {
      "get": {
        "tags": ["Tareas"],
        "summary": "Obtener tarea por ID",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "ID de la tarea",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Detalles de la tarea",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Tarea"
                }
              }
            }
          },
          "401": {
            "description": "No autorizado. Inicia sesión primero.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "No autorizado. Solo puedes acceder a tus propias tareas.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Tarea no encontrada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al obtener tarea por ID",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/tareas": {
      "post": {
        "tags": ["Tareas"],
        "summary": "Crear una nueva tarea",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TareaCreacion"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Tarea creada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Tarea"
                }
              }
            }
          },
          "401": {
            "description": "No autorizado. Inicia sesión primero.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al crear nueva tarea",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/tareas/{id}": {
      "put": {
        "tags": ["Tareas"],
        "summary": "Actualizar una tarea existente",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "ID de la tarea a actualizar",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TareaActualizacion"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Tarea actualizada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "mensaje": {
                      "type": "string",
                      "example": "Tarea actualizada"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "No autorizado. Inicia sesión primero.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "No autorizado. Solo puedes modificar tus propias tareas.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Tarea no encontrada o no se realizaron cambios",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al actualizar tarea",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Tareas"],
        "summary": "Eliminar una tarea",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "ID de la tarea a eliminar",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Tarea eliminada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "mensaje": {
                      "type": "string",
                      "example": "Tarea eliminada"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "No autorizado. Inicia sesión primero.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "No autorizado. Solo puedes eliminar tus propias tareas.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Tarea no encontrada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al eliminar tarea",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/tareas/ia": {
      "post": {
        "tags": ["Inteligencia Artificial"],
        "summary": "Generar tareas usando IA",
        "description": "Envía una pregunta o URL de PDF a un servicio de IA para generar tareas automáticamente.",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TareaAIRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Tareas procesadas y guardadas exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TareaAIResponse"
                }
              }
            }
          },
          "400": {
            "description": "La respuesta de la IA no contiene ninguna tarea.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "No autorizado. Inicia sesión primero.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "No se encontró ninguna tarea para procesar.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Error al procesar la solicitud de IA o al reparar el JSON de la IA.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "connect.sid",
        "description": "Autenticación basada en cookies de sesión. Se requiere haber iniciado sesión previamente."
      }
    },
    "schemas": {
      "Usuario": {
        "type": "object",
        "properties": {
          "pk": {
            "type": "integer",
            "description": "ID único del usuario",
            "readOnly": true
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email del usuario"
          }
        },
        "required": ["email"]
      },
      "UsuarioCreacion": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email del usuario"
          },
          "password": {
            "type": "string",
            "format": "password",
            "description": "Contraseña del usuario"
          }
        },
        "required": ["email", "password"]
      },
      "LoginRequest": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email del usuario"
          },
          "password": {
            "type": "string",
            "format": "password",
            "description": "Contraseña del usuario"
          }
        },
        "required": ["email", "password"]
      },
      "LoginResponse": {
        "type": "object",
        "properties": {
          "mensaje": {
            "type": "string",
            "example": "Inicio de sesión exitoso"
          },
          "usuario": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer",
                "description": "ID del usuario"
              },
              "email": {
                "type": "string",
                "format": "email",
                "description": "Email del usuario"
              }
            }
          },
          "secretKeyId": {
            "type": "string",
            "description": "ID de la clave secreta (AWS S3 Key ID)"
          },
          "secretKey": {
            "type": "string",
            "description": "Clave secreta (AWS S3 Secret Key)"
          }
        }
      },
      "Tarea": {
        "type": "object",
        "properties": {
          "pk": {
            "type": "integer",
            "description": "ID único de la tarea",
            "readOnly": true
          },
          "fecha_inicio": {
            "type": "string",
            "format": "date",
            "description": "Fecha de inicio de la tarea (YYYY-MM-DD)"
          },
          "fecha_fin": {
            "type": "string",
            "format": "date",
            "description": "Fecha de fin de la tarea (YYYY-MM-DD)"
          },
          "descripcion": {
            "type": "string",
            "description": "Descripción detallada de la tarea"
          },
          "prioridad": {
            "type": "string",
            "description": "Nivel de prioridad de la tarea (ej. 'Alta', 'Media', 'Baja')"
          },
          "titulo": {
            "type": "string",
            "description": "Título breve de la tarea"
          },
          "usuario": {
            "type": "integer",
            "description": "ID del usuario al que pertenece la tarea"
          },
          "tiempo_estimado": {
            "type": "string",
            "nullable": true,
            "description": "Tiempo estimado para completar la tarea (ej. '2 días', '3 horas')"
          },
          "horas": {
            "type": "integer",
            "nullable": true,
            "description": "Horas estimadas para la tarea"
          }
        },
        "required": ["fecha_inicio", "fecha_fin", "descripcion", "prioridad", "titulo", "usuario"]
      },
      "TareaCreacion": {
        "type": "object",
        "properties": {
          "fecha_inicio": {
            "type": "string",
            "format": "date",
            "description": "Fecha de inicio de la tarea (YYYY-MM-DD)",
            "example": "2024-07-29"
          },
          "fecha_fin": {
            "type": "string",
            "format": "date",
            "description": "Fecha de fin de la tarea (YYYY-MM-DD)",
            "example": "2024-07-30"
          },
          "descripcion": {
            "type": "string",
            "description": "Descripción detallada de la tarea",
            "example": "Preparar informe mensual de ventas."
          },
          "prioridad": {
            "type": "string",
            "description": "Nivel de prioridad de la tarea (ej. 'Alta', 'Media', 'Baja')",
            "example": "Alta"
          },
          "titulo": {
            "type": "string",
            "description": "Título breve de la tarea",
            "example": "Informe de Ventas"
          }
        },
        "required": ["fecha_inicio", "fecha_fin", "descripcion", "prioridad", "titulo"]
      },
      "TareaActualizacion": {
        "type": "object",
        "properties": {
          "fecha_inicio": {
            "type": "string",
            "format": "date",
            "description": "Fecha de inicio de la tarea (YYYY-MM-DD)",
            "example": "2024-07-29"
          },
          "fecha_fin": {
            "type": "string",
            "format": "date",
            "description": "Fecha de fin de la tarea (YYYY-MM-DD)",
            "example": "2024-07-30"
          },
          "descripcion": {
            "type": "string",
            "description": "Descripción detallada de la tarea",
            "example": "Preparar informe mensual de ventas actualizado."
          },
          "prioridad": {
            "type": "string",
            "description": "Nivel de prioridad de la tarea (ej. 'Alta', 'Media', 'Baja')",
            "example": "Media"
          },
          "titulo": {
            "type": "string",
            "description": "Título breve de la tarea",
            "example": "Informe de Ventas Actualizado"
          }
        }
      },
      "TareaAIRequest": {
        "type": "object",
        "properties": {
          "pdf_url": {
            "type": "string",
            "format": "url",
            "nullable": true,
            "description": "URL de un documento PDF para que la IA lo analice (opcional)",
            "example": "https://example.com/documento.pdf"
          },
          "question": {
            "type": "string",
            "description": "Pregunta o instrucción para la IA para generar tareas",
            "example": "¿Qué tareas necesito hacer para organizar una fiesta de cumpleaños para 10 personas?"
          }
        },
        "required": ["question"]
      },
      "TareaAIResponse": {
        "type": "object",
        "properties": {
          "tareasProcesadas": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "tarea": {
                  "type": "string",
                  "description": "Descripción de la tarea generada"
                },
                "tiempoEstimado": {
                  "type": "string",
                  "nullable": true,
                  "description": "Tiempo estimado por la IA para la tarea"
                },
                "horas": {
                  "type": "integer",
                  "nullable": true,
                  "description": "Horas estimadas para la tarea"
                },
                "insertId": {
                  "type": "integer",
                  "nullable": true,
                  "description": "ID de la tarea insertada en la base de datos (si fue exitosa)"
                },
                "error": {
                  "type": "string",
                  "nullable": true,
                  "description": "Mensaje de error si la tarea no pudo ser insertada"
                }
              }
            }
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Mensaje de error"
          }
        }
      }
    }
  }
}
